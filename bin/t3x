#!/usr/bin/env bash

# T3X_DEBUG=true # Enable debug messages
# T3X_RUN=false  # disable running of commands (pretends success)

SCRIPT_DIR=$(cd $(dirname $BASH_SCRIPT[0]) > /dev/null; pwd)
T3XLIB_DIR=$(realpath $SCRIPT_DIR/../lib)
source $T3XLIB_DIR/t3ize.sh

case "$1" in
  -h|--help)
    echo "usage: t3x COMMAND [ARGS]"
    exit
    ;;
  -V|--version)
    echo "t3ize version $T3IZE_VERSION"
    exit
    ;;
  -T|--t3xlib)
    echo "$T3XLIB_DIR"
    exit
    ;;
esac


debug "t3x : T3IZE_SCRIPTS_DIR=$T3IZE_SCRIPTS_DIR   T3IZE_LIB_DIR=$T3IZE_LIB_DIR"  
if (( $# == 0 )); then
  boom "No command given to execute. Exiting."
fi

# take the first argument as the command to execute
# check in the scripts folder for a script of the same name as the command
# if it exists, execute it
command=$1
shift
script="$T3IZE_SCRIPTS_DIR/$command.sh"
debug "script=$script"

if [ -f "$script" ]; then
  info "running script $script"
  $script $@
else
    if declare -f "$command" > /dev/null; then
        info "running function $command"
        $command $@
    else
        echo "no function found for $command"
    fi
fi


# if it doesn't exist, check for a function of the same name in the t3ize.sh file
# if it exists, execute it
